---
layout: post
categories: 공부, 스프링
---

## 우당탕탕 주니어 개발자의 자바 마이그레이션: 메일 서비스 추상화

### 주절주절 사건의 발단

대략 3개월 간의 파이썬 장고에서 자바 스프링 부트로의 마이그레이션이 끝났다. 거의 혼자 진행하느라 이렇게 하는게 맞는지 나날이 의문은 쌓여갔다. 주변 개발자분들께 묻고, 스터디하고, 책에서 배운 것들을 그날 그날 적용하며 마이그레이션을 진행했다. 

그날 그날 새로운 정보들이 업데이트되는 바람에 약 일주일전 코드는 바로 레거시 코드가 되었고, 계속 리팩토링을 하며 마이그레이션을 했다. 지금도 손봐야 할 곳이 여기저기 많이 있다. 우션 마이그레이션의 목표는 장고를 떼버리고 기존의 동작을 다 하는 것이었기 때문에 완료되었다고 보고있다. 마이그레이션을 진행하면서도 좋은 설계를 하고 싶은 욕심이 가득했어서 리팩토링을 놓지 않았다. 

지금부터 마이그레이션과 리팩토링을 하면서 배운 내용이나 고민되는 내용들을 하나씩 써보려고 한다. 제일 첫번째는 메일 서비스 추상화이다. 기존에는 AWS의 SES를 이용해서 메일 서비스를 했다. 하지만 AWS 의존성을 떼어내고 온프레미스에서도 사용할 수 있고 SMTP 서버가 바껴도 코드 구현의 변경이 아닌 설정만 변경해도 제대로 동작하는 서비스를 만들어야했다. 자바에서 제공하는 JavaMail을 이용해서 메일 발송을 구현했으나, 문제가 생겼다. 실제 동작하는 코드이나 테스트를 작성할 수가 없었다. 정확히 말하면 테스트도 이메일이 발송되거나 실제 SMTP 서버가 있어야 동작하게 만들어 버렸다. AWS 의존을 썼을 때는 추상화가 잘 되었던거 같은데 왜 이런 문제가 생겼을까? 그렇다면 메일 서비스는 어떻게 추상화하고 테스트를 하면되지? 고민이 생겼다. `디자인 패턴의 아름다움`이라는 책의 스터디를 준비하며, 같이 읽기를 하는 모임에서 다른 분들이 토비의 스프링에 나온다고 하셨다. 정확히 궁금했던 내용이 토비의 스프링 5.4절에 나왔다. 갓 토비!!!  그래서 지금부터 5.4절을 학습하고 실무에 적용하려고 한다. 


