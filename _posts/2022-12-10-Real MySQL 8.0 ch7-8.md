---
layout: post
categories: 공부 
---

# 7 데이터 암호화 

응용 프로그램의 암호화는 주로 중요 정보를 가진 칼럼 단위로 암호화를 수행하며, 데이터베이스 수준에서는 테이블 단위로 암호화를 적용한다. 

데이터베이스 서버와 디스크 사이의 데이터 읽고 쓰기 지점에서 암호화 또는 복호화를 수행한다. MySQL 서버의 I/O 레이어에서만 데이터의 암호화 및 복호화 과정이 실행된다. 데이터 암호화 기능이 활성화되어 있어도 사용자 입장에서는 아무런 차이가 없다(TDE, Transparent Data Encryption). 

데이터 암호화는 마스터 키와 테이블스페이스 키라는 두 종류를 가지고 있다. 
마스터 키는 외부의 파일에서 가져오고, 암호화된 테이블이 생성될 때마다 해당 테이블을 위한 임의의 테이블스페이스 키를 발급한다. 마스터 키를 이용해서 테이블스페이스 키를 발급한다. 테이블스페이스 키는 외부에 노출되지 않기 때문에 변경하지 않아도 보안상 취약점이 되지 않지만, 마스터 키는 외부 파일을 이용하기 때문에 보안상 취약하여 주기적으로 변경해야 한다. 

암호화한다고 해서 InnoDB 버퍼 풀의 효율이 달라지거나 메모리 사용 효율이 떨어지는 현상은 발생하지 않는다. 데이터 페이지가 암호화 키보다 훨씬 크기 때문에 암호화 결과가 평문의 결과와 동일한 크기의 암호문을 반환한다. 

같은 테이블에 대해 암호화와 압축이 동시에 적용되면 압축을 먼저 실행하고 암호화를 적용한다. 

소스 서버와 레플리카 서버는 서로 각자의 마스터 키와 테이블스페이스 키를 관리하기 때문에 복제 멤버들의 데이터 파일은 암호화되기 전의 값이 동일하더라도 실제 암호화된 데이터가 저장된 데이터 파일의 내용은 완전히 달라진다. 

응용 프로그램의 암호화는 이미 암호화된 값을 테이블에 넣기 때문에 정렬해서 가져오는 쿼리를 사용할 수 없다. 하지만 MySQL 서버의 암호화 기능은 인덱스 관련 작업을 모두 처리한 후 최종 디스크에 데이터 페이지를 저장할 때만 암호화하기 때문에 제약이 없다. 
단, MySQL 서버의 암호화는 서버에 로그인이 가능하면 평문의 내용을 확인할 수 있다. 

리두 로그나 언두 로그를 평문으로 저장하다가 암호화가 활성화되면 그때부터 생성되는 리두 로그나 언두 로그만 암호화해서 저장한다. 

일반적으로 리두 로그나 언두 로그는 길지 않은 시간 동안의 데이터만 가지기 때문에 크게 보안에 민감하지 않을 수 있지만 바이너리 로그는 의도적으로 상당히 긴 시간 동안 보관하는 서비스도 있고 증분 백업을 위해 바이너리 로그를 보관하기도 해서 바이너리 로그 파일의 암호화는 상황에 따라 중요도가 높아질 수도 있다.    
트랜잭션의 내용을 추적하거나 백업 복구를 위해 암호화된 바이너리 로그를 평문으로 복호화할 일이 자주 발생한다. 


